

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>} &mdash; Selene master documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway" type="text/css" />
  <link rel="stylesheet" href="../_static/css/selene_docs_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="faq.html" />
    <link rel="prev" title="&lt;no title&gt;" href="tutorials.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Selene
          

          
            
            <img src="../_static/selene_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                master (0.4.8)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          

            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id10">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id21">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id26">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id31">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id36">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id41">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id46">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id53">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id64">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id69">}</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id74">}</a></li>
</ul>
<p class="caption"><span class="caption-text">Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../selene.html">selene_sdk</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../selene.html#trainmodel">TrainModel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../selene.html#evaluatemodel">EvaluateModel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interpret.html">selene_sdk.interpret</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../interpret.html#sequence-logo">sequence_logo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpret.html#heatmap">heatmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpret.html#ismresult">ISMResult</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpret.html#rescale-score-matrix">rescale_score_matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpret.html#load-variant-abs-diff-scores">load_variant_abs_diff_scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpret.html#variant-diffs-scatter-plot">variant_diffs_scatter_plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpret.html#ordered-variants-and-indices">ordered_variants_and_indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpret.html#sort-standard-chrs">sort_standard_chrs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../predict.html">selene_sdk.predict</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../predict.html#analyzesequences">AnalyzeSequences</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../samplers.html">selene_sdk.samplers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../samplers.html#sampler">Sampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../samplers.html#onlinesampler">OnlineSampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../samplers.html#intervalssampler">IntervalsSampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../samplers.html#randompositionssampler">RandomPositionsSampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../samplers.html#multifilesampler">MultiFileSampler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../samplers.file_samplers.html">selene_sdk.samplers.file_samplers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../samplers.file_samplers.html#bedfilesampler">BedFileSampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../samplers.file_samplers.html#matfilesampler">MatFileSampler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sequences.html">selene_sdk.sequences</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sequences.html#sequence">Sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sequences.html#genome">Genome</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sequences.html#proteome">Proteome</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sequences.html#sequence-to-encoding">sequence_to_encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sequences.html#encoding-to-sequence">encoding_to_sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sequences.html#get-reverse-encoding">get_reverse_encoding</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../targets.html">selene_sdk.targets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../targets.html#target">Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="../targets.html#genomicfeatures">GenomicFeatures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">selene_sdk.utils</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#nonstrandspecific">NonStrandSpecific</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#performancemetrics">PerformanceMetrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#initialize-logger">initialize_logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#load-features-list">load_features_list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#load-model-from-state-dict">load_model_from_state_dict</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#get-indices-and-probabilities">get_indices_and_probabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#load-path-for-config-yml">load_path (for config.yml)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#instantiate-configuration-object">instantiate (configuration object)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#initialize-model">initialize_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#parse-configs-and-run">parse_configs_and_run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#execute-run-selene-operations">execute (run Selene operations)</a></li>
</ul>
</li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Selene</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>}</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/overview/cli.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p># Selene CLI operations and outputs
Selene provides a command-line interface (CLI) that takes in a user-specified configuration file containing the operations the user wants to run and the parameters required for these operations.
It is automatically installed using a setuptools entrypoint so it can be called with the bash function
<cite>selene_sdk</cite> from anywhere in the bash. It can also be called with <cite>python -m selene_sdk</cite>.
See [Operations](#operations) for more detail.</p>
<p>The sections that follow describe in detail how the various components that make up the configuration file are specified. For operation-specific sections (e.g. training, evaluation), we also explain what the expected outputs are.</p>
<p>We strongly recommend you read through the first 4 sections ([Overview](#overview), [Operations](#operations), [General configurations](#general-configurations), and [Model architecture](#model-architecture)) and then pick other sections based on your use case.</p>
<p>Join our [Google group](<a class="reference external" href="https://groups.google.com/forum/#!forum/selene-sdk">https://groups.google.com/forum/#!forum/selene-sdk</a>) if you have questions about the package, case studies, or model development.</p>
<p>## Overview
Selene’s CLI accepts configuration files in the [YAML](<a class="reference external" href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html">https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html</a>) format that are composed of 4 main (high-level) groups:
1. list of operations
2. general configuration parameters
3. model configuration
4. operation-specific configurations</p>
<p>“Operation-specific configurations” require you to specify the input parameters for different classes and methods that we have implemented in Selene. These configurations are parsed using code adapted from the [Pylearn2 library](<a class="reference external" href="http://deeplearning.net/software/pylearn2/yaml_tutorial/index.html#yaml-tutorial">http://deeplearning.net/software/pylearn2/yaml_tutorial/index.html#yaml-tutorial</a>) and will instantiate the appropriate Python object or function based on your inputs. You may use Selene’s [API documentation](<a class="reference external" href="https://selene.flatironinstitute.org">https://selene.flatironinstitute.org</a>) to determine what parameters are accepted by the constructors/methods implemented in Selene. For your convenience, we have created this document to specifically describe the parameters necessary to build configuration files for the Selene CLI.</p>
<p>We recommend you start off by using one of the [example configuration files](<a class="reference external" href="https://github.com/FunctionLab/selene/tree/master/config_examples">https://github.com/FunctionLab/selene/tree/master/config_examples</a>) provided in the repository as a template for your own configuration file:
- [Training configuration](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/config_examples/train.yml">https://github.com/FunctionLab/selene/blob/master/config_examples/train.yml</a>)
- [Evaluate with test BED file](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/config_examples/evaluate_test_bed.yml">https://github.com/FunctionLab/selene/blob/master/config_examples/evaluate_test_bed.yml</a>)
- [Evaluate with test matrix file](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/config_examples/evaluate_test_mat.yml">https://github.com/FunctionLab/selene/blob/master/config_examples/evaluate_test_mat.yml</a>)
- [Get predictions from trained model](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/config_examples/get_predictions.yml">https://github.com/FunctionLab/selene/blob/master/config_examples/get_predictions.yml</a>)
- [_In <a href="#id99"><span class="problematic" id="id100">silico_</span></a> mutagenesis](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/config_examples/in_silico_mutagenesis.yml">https://github.com/FunctionLab/selene/blob/master/config_examples/in_silico_mutagenesis.yml</a>)
- [Variant effect prediction](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/config_examples/variant_effect_prediction.yml">https://github.com/FunctionLab/selene/blob/master/config_examples/variant_effect_prediction.yml</a>)</p>
<p>There are also various configuration files associated with the Jupyter notebook [<cite>tutorials</cite>](<a class="reference external" href="https://github.com/FunctionLab/selene/tree/master/tutorials">https://github.com/FunctionLab/selene/tree/master/tutorials</a>) and [<cite>manuscript</cite>](<a class="reference external" href="https://github.com/FunctionLab/selene/tree/master/manuscript">https://github.com/FunctionLab/selene/tree/master/manuscript</a>) case studies that you may use as a starting point.</p>
<p>## Operations
Every file should start with the operations that you want to run.</p>
<p><code class="docutils literal notranslate"><span class="pre">`YAML</span>
<span class="pre">ops:</span> <span class="pre">[train,</span> <span class="pre">evaluate,</span> <span class="pre">analyze]</span>
<span class="pre">`</span></code>
The <cite>ops</cite> key expects one or more of <cite>[train, evaluate, analyze]</cite> to be specified as a list. In addition to the general and model architecture configurations described in the next 2 sections, each of these operations will require some additional set of configurations attached to the following keys:
- <cite>train</cite>: <cite>train_model</cite> (see [Train](#train)) and <cite>sampler</cite> (see [Samplers used for training](#samplers-used-for-training-and-evaluation-optionally))
- <cite>evaluate</cite>: <cite>evaluate_model</cite> (see [Evaluate](#evaluate)) and <cite>sampler</cite> (see [Samplers used for evaluation](#samplers-used-for-evaluation))
- <cite>analyze</cite>: <cite>analyze_sequences</cite> (see [Analyze sequences](#analyze-sequences)) and one of [<cite>prediction</cite>](#prediction-on-sequences), [<cite>variant_effect_prediction</cite>](#variant-effect-prediction), or [<cite>in_silico_mutagenesis</cite>](#in-silico-mutagenesis).</p>
<p><strong>Note</strong>: You should be able to use multiple operations (i.e. specify the necessary configuration keys for those operations in a single file). However, if <cite>[train, evaluate]</cite> are both specified, we expect that they will both rely on the same sampler. If you need to train and evaluate using different samplers, please create 2 separate YAML files.</p>
<p>## General configurations
In addition to the <cite>ops</cite> key, you can specify the following parameters:</p>
<p><code class="docutils literal notranslate"><span class="pre">`YAML</span>
<span class="pre">random_seed:</span> <span class="pre">1337</span>
<span class="pre">output_dir:</span> <span class="pre">/absolute/path/to/output/dir</span>
<span class="pre">create_subdirectory:</span> <span class="pre">True</span>
<span class="pre">lr:</span> <span class="pre">0.01</span>
<span class="pre">load_test_set:</span> <span class="pre">True</span>
<span class="pre">`</span></code></p>
<p>Note that there should not be any commas at the end of these lines.
- <cite>random_seed</cite>: Set a random seed for <cite>torch</cite> and <cite>torch.cuda</cite> (if using CUDA-enabled GPUs) for reproducibility.
- <cite>output_dir</cite>: The output directory to use for all operations. If no <cite>output_dir</cite> is specified, Selene assumes that the <cite>output_dir</cite> is specified in all relevant function-type values for operations in Selene. (More information on what function-type values are in [later sections](#a-note-for-the-following-sections).) We recommend using this parameter for <cite>train</cite> and <cite>evaluate</cite> operations.
- <cite>create_subdirectory</cite>: If True, creates a directory within <cite>output_dir</cite>   with the name formatted as <cite>%Y-%m-%d-%H-%M-%S</cite>—the date/time when Selene was run. (This is only applicable if <cite>output_dir</cite> has been specified.)
- <cite>lr</cite>:  The learning rate. If you use the CLI (<cite>selene_sdk</cite>), you can pass this in as a command-line argument rather than having it specified in the configuration file.
- <cite>load_test_set</cite>: This is only applicable if you have specified <cite>ops: [train, evaluate]</cite>. You can set this parameter to True (by default it is False and the test set is only loaded when training ends) if you would like to load the test set into memory before training begins—and therefore save the test data generated by a sampler to a .bed file. You would find this useful if you want to save a test dataset (see [Samplers used for training](#samplers-used-for-training-and-evaluation-optionally)) and you do not know if your model will finish training and evaluation within the allotted time that your job is run. You should also be running Selene on a machine that can support such an increase in memory usage (on the order of GBs, depending on how many classes your model predicts, how large the test dataset is, etc.).</p>
<p>## Model architecture
For all operations, Selene requires that you specify the model architecture, loss, and optimizer as inputs.</p>
<p>### Expected input class and methods
There are two possible formats you can use to do this:</p>
<ul>
<li><p>single Python file: We expect that most people will start using Selene with model architectures in this format. In this case, you implement your architecture as a class and include 2 static methods, <cite>criterion</cite> and <cite>get_optimizer</cite> in the same file. See our [DeepSEA model file](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/models/deepsea.py">https://github.com/FunctionLab/selene/blob/master/models/deepsea.py</a>) as an example.</p>
<blockquote>
<div><ul class="simple">
<li><p>The <cite>criterion</cite> method should not take any input arguments and must return a loss function object of type <cite>torch.nn._Loss</cite>.</p></li>
<li><p>The <cite>get_optimizer</cite> method should accept a single input <cite>lr</cite>, the learning rate. (Note that this method is not used for the <cite>evaluate</cite> and <cite>analyze</cite> operations in Selene.) It returns a tuple, where <cite>tuple[0]</cite> is the optimizer class <cite>torch.optim.Optimizer</cite> and <cite>tuple[1]</cite> is a dictionary of any optional arguments with which Selene can then instantiate the class. Selene will first instantiate the model and then pass the required <cite>model.parameters()</cite> argument as input to the <cite>torch.optim.Optimizer</cite> class constructor.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Python module: For more complicated architectures, you may want to write custom PyTorch modules and use them in your final architecture. In this case, it is likely your model architecture imports other custom classes. We ask that you then specify your architecture within a Python module. That is, the directory containing your architecture, loss, and optimizer must have a <cite>__init__.py</cite> that imports the architecture class, <cite>criterion</cite>, and <cite>get_optimizer</cite>.</p></li>
</ul>
<p>### Model architecture configuration</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>YAML
model: {</p>
<blockquote>
<div><p>path: /absolute/path/to/file_or_model,
class: ModelArchitectureClassName,
class_args: {</p>
<blockquote>
<div><p>arg1: val1,
arg2: val2,
…</p>
</div></blockquote>
<p>},
non_strand_specific: mean</p>
</div></blockquote>
<div class="section" id="id5">
<h1>}<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><cite>path</cite>: This can be the path to a Python file or a Python module (directory). See the [previous section](#expected-input-class-and-methods) for details.</p></li>
<li><p><cite>class</cite>: The model architecture class name.</p></li>
<li><p><cite>class_args</cite>: The arguments needed to instantiate the class. In the case of [DeepSEA](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/models/deepsea.py">https://github.com/FunctionLab/selene/blob/master/models/deepsea.py</a>), the <cite>class_args</cite> keys would be <cite>sequence_length</cite> and <cite>n_genomic_features</cite>.</p></li>
<li><p><cite>non_strand_specific</cite>: Optional, possible values are <cite>mean</cite> or <cite>max</cite> if you want to use this parameter. (Otherwise, do not use this key in your model configuration.) If your model does not need to train on strand-specific input sequences, we have implemented a class that will pass both the forward and reverse sequence to the model and either take the <cite>mean</cite> or the <cite>max</cite> value across the two sets of predictions for a sample.</p></li>
</ul>
<p>## A note for the following sections
For training, evaluation, and analysis [of sequences using trained models], Selene requires that specific keys in the YAML file correspond to function-type values. The function-type value is used to construct an object that is a class in <cite>selene_sdk</cite>. Our [documentation website](<a class="reference external" href="https://selene.flatironinstitute.org/">https://selene.flatironinstitute.org/</a>) is an important resource for debugging configuration-related errors when you run Selene via the CLI.</p>
<p>We have covered the most common configurations in this document.</p>
<p>## Train
An example configuration for training:</p>
<p><a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a>YAML
train_model: !obj:selene_sdk.TrainModel {</p>
<blockquote>
<div><p>batch_size: 64,
max_steps: 960000,
report_stats_every_n_steps: 32000,
save_checkpoint_every_n_steps: 1000,
save_new_checkpoints_after_n_steps: 640000,
n_validation_samples: 64000,
n_test_samples: 960000,
cpu_n_threads: 32,
use_cuda: True,
data_parallel: True,
logging_verbosity: 2,
metrics: {</p>
<blockquote>
<div><p>roc_auc: !import sklearn.metrics.roc_auc_score,
average_precision: !import sklearn.metrics.average_precision_score</p>
</div></blockquote>
<p>},
checkpoint_resume: False</p>
</div></blockquote>
</div>
<div class="section" id="id10">
<h1>}<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h1>
<p>#### Required parameters
- <cite>batch_size</cite>:  Number of samples in one forward/backward pass (a single step).
- <cite>max_steps</cite>: Total number of steps for which to train the model.
- <cite>report_stats_every_n_steps</cite>: The frequency with which to report summary statistics. You can set this value to be equivalent to a training epoch (<cite>n_steps * batch_size</cite>) being the total number of samples seen by the model so far. Selene evaluates the model on the validation dataset every <cite>report_stats_every_n_steps</cite> and, if the model obtains the best performance so far (based on the user-specified loss function), Selene saves the model state to a file called <cite>best_model.pth.tar</cite> in <cite>output_dir</cite>.</p>
<p>#### Optional parameters
- <cite>save_checkpoint_every_n_steps</cite>: Default is 1000. The number of steps before Selene saves a new checkpoint model weights file. If this parameter is set to <cite>None</cite>, we will set it to the same value as <cite>report_stats_every_n_steps</cite>.
- <cite>save_new_checkpoints_after_n_steps</cite>: Default is None. The number of steps after which Selene will continually save new checkpoint model weights files (<cite>checkpoint-&lt;TIMESTAMP&gt;.pth.tar</cite>) every <cite>save_checkpoint_every_n_steps</cite>. Before this, the file <cite>checkpoint.pth.tar</cite> is overwritten every <cite>save_checkpoint_every_n_steps</cite> to limit the memory requirements.
- <cite>n_validation_samples</cite>: Default is <cite>None</cite>. Specify the number of validation samples in the validation set. If <cite>None</cite></p>
<blockquote>
<div><ul class="simple">
<li><p>and the data sampler you use is of type <cite>selene_sdk.samplers.OnlineSampler</cite>, we will by default retrieve 32000 validation samples.</p></li>
<li><p>and you are using a <cite>selene_sdk.samplers.MultiFileSampler</cite>, we will use all the validation samples available in the appropriate data file.</p></li>
</ul>
</div></blockquote>
<ul>
<li><dl>
<dt><cite>n_test_samples</cite>: Default is <cite>None</cite>. Specify the number of test samples in the test set. If <cite>None</cite> and</dt><dd><ul class="simple">
<li><p>the sampler you specified has no test partition, you should not specify <cite>evaluate</cite> as one of the operations in the <cite>ops</cite> list. That is, Selene will not automatically evaluate your trained model on a test dataset, because the sampler you are using does not have any test data.</p></li>
<li><p>the sampler you use is of type <cite>selene_sdk.samplers.OnlineSampler</cite> (and the test partition exists), we will retrieve 640000 test samples.</p></li>
<li><p>the sampler you use is of type <cite>selene_sdk.samplers.MultiFileSampler</cite> (and the test partition exists), we will use all the test samples available in the appropriate data file.</p></li>
</ul>
<p>You can review the [section on samplers](#samplers-used-for-training-and-evaluation-optionally) for more information.</p>
</dd>
</dl>
</li>
<li><p><cite>cpu_n_threads</cite>: Default is 1. The number of OpenMP threads used for parallelizing CPU operations in PyTorch.</p></li>
<li><p><cite>use_cuda</cite>: Default is False. Specify whether CUDA-enabled GPUs are available for torch to use during training.</p></li>
<li><p><cite>data_parallel</cite>: Default is False. Specify whether multiple GPUs are available for torch to use during training.</p></li>
<li><p><cite>logging_verbosity</cite>: Default is 2. Possible values are <a href="#id11"><span class="problematic" id="id12">`</span></a>{0, 1, 2}</p></li>
</ul>
<dl class="simple">
<dt><a href="#id13"><span class="problematic" id="id14">`</span></a>. Sets the logging verbosity level:</dt><dd><ul class="simple">
<li><p>0: only warnings are logged</p></li>
<li><p>1: information and warnings are logged</p></li>
<li><p>2: debug messages, information, and warnings are all logged</p></li>
</ul>
</dd>
</dl>
<ul class="simple">
<li><p><cite>metrics</cite>: Default is a dictionary with <cite>“roc_auc”</cite> mapped to <cite>sklearn.metrics.roc_auc_score</cite> and <cite>“average_precision”</cite> mapped to <cite>sklearn.metrics.average_precision_score</cite>. <cite>metrics</cite> is a dictionary that maps metric names (<cite>str</cite>) to metric functions. In addition to the [loss function you specified with your model architecture](#expected-input-class-and-methods), these are the metrics that you would like to monitor during the training/evaluation process (they all get reported every <cite>report_stats_every_n_steps</cite>). See the [Regression Models in Selene](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/tutorials/regression_mpra_example/regression_mpra_example.ipynb">https://github.com/FunctionLab/selene/blob/master/tutorials/regression_mpra_example/regression_mpra_example.ipynb</a>) tutorial for a different input to the <cite>metrics</cite> parameter. You can <cite>!import</cite> metrics from <cite>scipy</cite>, <cite>scikit-learn</cite>, <cite>statsmodels</cite>. Each metric function should require, in order, the true values and predicted values as input arguments. For example,
[<cite>sklearn.metrics.average_precision_score</cite>](<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.average_precision_score.html">https://scikit-learn.org/stable/modules/generated/sklearn.metrics.average_precision_score.html</a>) takes <cite>y_true</cite> and <cite>y_score</cite> as input.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p><cite>checkpoint_resume</cite>: Default is <cite>None</cite>. If not <cite>None</cite>, you should pass in the path to a model weights file generated by <cite>torch.save</cite> (and can now be read by <cite>torch.load</cite>) to resume training.</p></li>
</ul>
</div></blockquote>
<p>#### Additional notes
Attentive readers might have noticed that in the [documentation for the <cite>TrainModel</cite> class](<a class="reference external" href="https://selene.flatironinstitute.org/selene.html#trainmodel">https://selene.flatironinstitute.org/selene.html#trainmodel</a>) there are more input arguments than are required to instantiate the class through the CLI configuration file. This is because they are assumed to be carried through/retrieved from other configuration keys for consistency. Specifically:
- <cite>output_dir</cite> can be specified as a top-level key in the configuration. You can specify it within each function-type constructor (e.g.  <cite>!obj:selene_sdk.TrainModel</cite>) if you prefer. If <cite>output_dir</cite> exists as a top-level key, Selene does use the top-level <cite>output_dir</cite> and ignores all other <cite>output_dir</cite> keys. <strong>The `output_dir` is omitted in many of the configurations for this reason.</strong>
- <cite>model</cite>, <cite>loss_criterion</cite>, <cite>optimizer_class</cite>, <cite>optimizer_kwargs</cite> are all retrieved from the path in the [<cite>model</cite> configuration](#model-architecture).
- <a href="#id15"><span class="problematic" id="id16">`</span></a>data_sampler`has its own separate configuration that you will need to specify in the same YAML file. Please see [Sampler configurations](#sampler-configurations) for more information.</p>
<p>#### Expected outputs for training
These outputs will be written to <cite>output_dir</cite> (a top-level parameter, can also  be specified within the function-type constructor, see above).
- <cite>best_model.pth.tar</cite>: the best performing model so far. IMPORTANT: for all <cite>*.pth.tar</cite> files output by Selene right now, we save additional information beyond the model’s state dictionary so that users may continue training these models through Selene if they wish. If you would like to save only the state dictionary, you can run <cite>out = torch.load(&lt;*.pth.tar&gt;)</cite> and then save only the <cite>state_dict</cite> key with <cite>torch.save(out[“state_dict”], &lt;state_dict_only.pth.tar&gt;)</cite>.
- <cite>checkpoint.pth.tar</cite>: model saved every <cite>save_checkpoint_every_n_steps</cite> steps
- <cite>selene_sdk.train_model.log</cite>: a detailed log file containing information about how much time it takes for batches to sampled and propagated through the model, how the model is performing, etc.
- <cite>selene_sdk.train_model.train.txt</cite>: model training loss is printed to this file every <cite>report_stats_every_n_steps</cite>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Visualize using <cite>matplotlib</cite> (<cite>plt.plot</cite>)</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt><cite>selene_sdk.train_model.validation.txt</cite>: model validation loss and other metrics you have specified (defaults would be ROC AUC and AUPRC) are printed to this file (tab-separated) every <cite>report_stats_every_n_steps</cite>.</dt><dd><ul>
<li><p>Visualize one of these columns using <cite>matplotlib</cite> (<cite>plt.plot</cite>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>saved sampled datasets (if applicable), e.g. <cite>test_data.bed</cite>: if the <cite>save_datasets</cite> value is not an empty list, Selene periodically saves all the data sampled so far in these .bed files. The columns of these files are <cite>[chr, start, end, strand, semicolon_separated_class_indices]</cite>. In the future, we will adjust this file to support non-binary labels (i.e. since we are only storing class indices in these output .bed files, we can only label sequences with 1/0, presence/absence, of a given class).</p></li>
</ul>
<p>## Evaluate</p>
<p>An example configuration for evaluation:
<a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a>YAML
evaluate_model: !obj:selene_sdk.EvaluateModel {</p>
<blockquote>
<div><dl class="simple">
<dt>features: !obj:selene_sdk.utils.load_features_list {</dt><dd><p>input_path: /path/to/features_list.txt</p>
</dd>
</dl>
<p>},
use_features_ord: !obj:selene_sdk.utils.load_features_list {</p>
<blockquote>
<div><p>input_path: /path/to/features_subset_ordered.txt</p>
</div></blockquote>
<p>},
trained_model_path: /path/to/trained/model.pth.tar,
batch_size: 64,
n_test_samples: 640000,
report_gt_feature_n_positives: 50,
use_cuda: True</p>
</div></blockquote>
</div>
<div class="section" id="id21">
<h1>}<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h1>
<p>#### Required parameters
- <cite>features</cite>: The list of distinct features the model predicts. (<cite>input_path</cite> to the function-type value that loads the features as a list.)
- <cite>trained_model_path</cite>: Path to the trained model weights file, which should have been generated/saved using <cite>torch.save</cite>. (i.e. you can pass in the saved model file generated by Selene’s <cite>TrainModel</cite> class.)</p>
<p>#### Optional parameters
- <cite>batch_size</cite>: Default is 64. Specify the batch size to process examples. Should be a power of 2.
- <cite>n_test_samples</cite>: Default is <cite>None</cite>. Use <cite>n_test_samples</cite> if you want to limit the number of samples on which you evaluate your model. If you are using a sampler of type [<cite>selene_sdk.samplers.OnlineSampler</cite>](#samplers-used-for-training-and-evaluation-optionally))—you must specify a test partition in this case—it will default to 640000 test samples if <cite>n_test_samples = None</cite>. If you are using a file sampler ([multiple-file sampler](#multiple-file-sampler) or [BED](#bed-file-sampler)/[matrix](#matrix-file-sampler) file samplers), it will use all samples available in the file.
- <cite>report_gt_feature_n_positives</cite>: Default is 10. In total, each class/feature must have more than <cite>report_gt_feature_n_positives</cite> positive examples in the test set to be considered in the performance computation. The output file that reports each class’s performance will report ‘NA’ for classes that do not have enough positive samples.
- <cite>use_cuda</cite>: Default is False. Specify whether CUDA-enabled GPUs are available for torch to use.
- <cite>data_parallel</cite>: Default is False. Specify whether multiple GPUs are available for torch to use.
- <cite>use_features_ord</cite>: Default is None. Specify an ordered list of features for which to run the evaluation. The features in this list must be identical to or a subset of <cite>features</cite>, and in the order you want the resulting <cite>test_targets.npz</cite> and <cite>test_predictions.npz</cite> to be saved.</p>
<p>#### Additional notes
Similar to the <cite>train_model</cite> configuration, any arguments that you find in [the documentation](<a class="reference external" href="https://selene.flatironinstitute.org/selene.html#evaluatemodel">https://selene.flatironinstitute.org/selene.html#evaluatemodel</a>) that are not present in the function-type value’s arguments are automatically instantiated and passed in by Selene.</p>
<p>If you use a [sampler with multiple data partitions](#samplers-used-for-training-and-evaluation-optionally) with the <cite>evaluate_model</cite> configuration, <strong>please make sure that your sampler configuration’s `mode` parameter is set to `test`</strong>.</p>
<p>#### Expected outputs for evaluation
These outputs will be written to <cite>output_dir</cite> (a top-level parameter, can also  be specified within the function-type constructor).
- <cite>test_performance.txt</cite>: columns are <cite>class</cite> and whatever other metrics you specified (defaults: <cite>roc_auc</cite> and <cite>average_precision</cite>). The breakdown of performance metrics by each class that the model predicts.
- <cite>test_predictions.npz</cite>: The model predictions for each sample in the test set. Useful if you want to make your own visualizations/figures.
- <cite>test_targets.npz</cite>: The actual classes for each sample in the test set. Useful if you want to make your own visualizations/figures.
- <cite>precision_recall_curves.svg</cite>: If using AUPRC as a metric, this is an AUPRC figure that we generate for you. Each curve corresponds to one of the classes the model predicts.
- <cite>roc_curves.svg</cite>: If using ROC AUC as a metric, this is an ROC AUC figure that we generate for you. Each curve corresponds to one of the classes the model predicts.
- <cite>selene_sdk.evaluate_model.log</cite>: Note that if <cite>evaluate</cite> is run through <cite>train_model</cite> (that is, no <cite>evaluate_model</cite> configuration was specified, but you used <cite>ops: [train, evaluate]</cite>) you will only see <cite>selene_sdk.train_model.log</cite>. <cite>selene_sdk.evaluate_model.log</cite> is created when <cite>evaluate_model</cite> is used and will output some logging information related to the <cite>selene_sdk.EvaluateModel</cite> class (some debug statements and performance metrics).</p>
<p>## Analyze sequences
The <cite>analyze</cite> operation allows you to apply a trained model to new sequences of interest. Currently, we support 3 “sub-operations” for <cite>analyze</cite>:</p>
<ol class="arabic simple">
<li><p>Prediction on sequences: Output the model predictions for a list of sequences.</p></li>
<li><p>Variant effect prediction: Output the model predictions for sequences centered on specific variants (will output reference and alternate predictions as separate files).</p></li>
<li><p>_In <a href="#id101"><span class="problematic" id="id102">silico_</span></a> mutagenesis: _In <a href="#id103"><span class="problematic" id="id104">silico_</span></a> mutagenesis (ISM) involves computationally “mutating” every position in the sequence to every other possible base (DNA and RNA) or amino acid (protein sequences) and examining the consequences of these “mutations”. For ISM, Selene outputs the model predictions for the reference (original) sequence along with each of the mutated sequences.</p></li>
</ol>
<p>For variant effect prediction and _in <a href="#id105"><span class="problematic" id="id106">silico_</span></a> mutagenesis, a number of scores can be computed using the predictions from the reference and alternate alleles. You may select 1 or more of the following as outputs:
- <cite>predictions</cite> (output the predictions for each variant, as described above)
- <cite>diffs</cite> (difference scores): The difference between alt and ref predictions.
- <cite>abs_diffs</cite> (absolute difference scores): The absolute difference between alt and ref predictions.
- <cite>logits</cite> (log-fold change scores): The difference between <cite>logit(alt)</cite> and <cite>logit(ref)</cite> predictions.</p>
<p>You’ll find examples of how these scores are specified in the [variant effect prediction](#variant-effect-prediction) and [_in <a href="#id107"><span class="problematic" id="id108">silico_</span></a> mutagenesis](#in-silico-mutagenesis) sections.</p>
<p>In all <cite>analyze</cite>-related operations, we ask that you specify 2 configuration keys. One will always be the <cite>analyze_sequences</cite> key and the other one is dependent on which of the 3 sub-operations you use: <cite>prediction</cite>, <cite>variant_effect_prediction</cite> or <cite>in_silico_mutagenesis</cite>.
<a href="#id22"><span class="problematic" id="id23">``</span></a><a href="#id24"><span class="problematic" id="id25">`</span></a>YAML
analyze_sequences: !obj:selene_sdk.predict.AnalyzeSequences {</p>
<blockquote>
<div><p>trained_model_path: /path/to/trained/model.pth.tar,
sequence_length: 1000,
features: !obj:selene_sdk.utils.load_features_list {</p>
<blockquote>
<div><p>input_path: /path/to/features_list.txt</p>
</div></blockquote>
<p>},
batch_size: 64,
use_cuda: False,
reference_sequence: !obj:selene_sdk.sequences.Genome {</p>
<blockquote>
<div><p>input_path: /path/to/reference_sequence.fa</p>
</div></blockquote>
<p>},
write_mem_limit: 5000</p>
</div></blockquote>
</div>
<div class="section" id="id26">
<h1>}<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h1>
<p>#### Required parameters
- <cite>trained_model_path</cite>: Path to the trained model weights file, which should have been generated/saved using <cite>torch.save</cite>. (i.e. You can pass in the saved model file generated by Selene’s <cite>TrainModel</cite> class.)
- <cite>sequence_length</cite>: The sequence length the model is expecting for each input.
- <cite>features</cite>: The list of distinct features the model predicts. (<cite>input_path</cite> to the function-type value that loads the features as a list.)</p>
<p>#### Optional parameters
- <cite>batch_size</cite>: Default is 64. The size of the mini-batches to use.
- <cite>use_cuda</cite>: Default is <cite>False</cite>. Specify whether CUDA-enabled GPUs are available for torch to use.
- <cite>reference_sequence</cite>: Default is the class <cite>selene_sdk.sequences.Genome</cite>. The type of sequence on which this analysis will be performed (must be type <cite>selene.sequences.Sequence</cite>).</p>
<blockquote>
<div><ul class="simple">
<li><p>IMPORTANT: For variant effect prediction and prediction on sequences in a BED file, the reference sequence version should correspond to the version used to specify the chromosome and position of each variant, NOT necessarily the one on which your model was trained.</p></li>
<li><p>For prediction on sequences in a FASTA file and _in <a href="#id109"><span class="problematic" id="id110">silico_</span></a> mutagenesis, the only thing that matters is the sequence type—that is, Selene uses the static variables in the class for information about the sequence alphabet and encoding. One problem with our current configuration file parsing is that it asks you to pass in a valid input FASTA file even though you do not need the reference sequence for these 2 sub-operations. We aim to resolve this issue in the future.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><cite>write_mem_limit</cite>: Default is 5000. Specify, in MB, the amount of memory you want to allocate to storing model predictions/scores. When running one of the sub-operations in <cite>analyze</cite>, prediction/score handlers will accumulate data in memory and write this data to files periodically. By default, Selene will write to files when the <strong>total amount</strong> of data (that is, across all handlers) takes up 5000MB of space. Please keep in mind that Selene will not monitor the amount of memory needed to actually carry out a sub-operation (or load the model beforehand), so <cite>write_mem_limit</cite> must always be less than the total amount of CPU memory you have available on your machine. It is hard to recommend a specific proportion of memory you would allocate for <cite>write_mem_limit</cite> because it is dependent on your input file size (we may change this soon, but Selene currently loads all variants/sequences in a file into memory before running the sub-operation), the model size, and whether the model will run on CPU or GPU.</p></li>
</ul>
<p>### Prediction on sequences
For prediction on sequences, we require that a user specifies the path to a FASTA file or BED file.</p>
<p>An example configuration for prediction on sequences:
<a href="#id27"><span class="problematic" id="id28">``</span></a><a href="#id29"><span class="problematic" id="id30">`</span></a>YAML
prediction: {</p>
<blockquote>
<div><p>input_path: /path/to/sequences.bed,
output_dir: /path/to/output/dir,
output_format: tsv,
strand_index: 5</p>
</div></blockquote>
</div>
<div class="section" id="id31">
<h1>}<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h1>
<p>#### Parameters
- <cite>input_path</cite>: Input path to the FASTA or BED file. For BED file input, we only use the genome regions specified in each row for finding the center position of the input sequence to the model. That is, the start and end of each coordinate does not need to be the same length as the expected model input sequence length–Selene will handle creating the correct sequence input for you.
- <cite>output_dir</cite>: Output directory to write the model predictions. The resulting file will have the same filename prefix (e.g. <cite>example.fasta</cite> will output <cite>example_predictions.tsv</cite>).
- <cite>output_format</cite>: Default is ‘tsv’. You may specify either ‘tsv’ or ‘hdf5’. ‘tsv’ is suitable if you do not have many sequences (&lt;1000) or your model does not predict very many classes (&lt;1000) and you want to be able to view the full set of predictions quickly and easily (via a text editor or Excel). ‘hdf5’ is suitable for downstream analysis. You can access the data in the HDF5 file using the Python package <cite>h5py</cite>. Once the file is loaded, the full matrix is accessible under the key/name <cite>“data”</cite>. Saving to TSV is much slower (more than 2x slower) than saving to HDF5. An additional .txt file with the row labels (descriptions for each sequence in the FASTA) will be output for the HDF5 format as well. It should be ordered in the same way as your input file. The matrix rows will correspond to each sequence and the columns the classes the model predicts.
- <cite>strand_index</cite>: Default is None. If input is BED file, you may specify the column index (0-based) that contains strand information. Otherwise we assume all sequences passed into the model will be fetched from the forward strand. The reference and alternate alleles specified in the VCF should still be for the forward strand–Selene will apply reverse complement to those alleles when strand is ‘-‘.</p>
<p>### Variant effect prediction
Currently, we expect that all sequences passed as input to a model must be the same length <cite>N</cite>.
- For SNPs, Selene outputs the model predictions for the ref and alt sequences centered at the <cite>(chr, pos)</cite> specified.
- For indels, sequences are centered at <cite>pos + (N_bases / 2)</cite>, for the reference sequence of length <cite>N_bases</cite>.</p>
<p>An example configuration for variant effect prediction:
<a href="#id32"><span class="problematic" id="id33">``</span></a><a href="#id34"><span class="problematic" id="id35">`</span></a>YAML
variant_effect_prediction: {</p>
<blockquote>
<div><dl class="simple">
<dt>vcf_files: [</dt><dd><p>/path/to/file1.vcf,
/path/to/file2.vcf,
…</p>
</dd>
</dl>
<p>],
save_data: [abs_diffs],
output_dir: /path/to/output/predictions/dir,
output_format: hdf5,
strand_index: 7,
require_strand: True</p>
</div></blockquote>
</div>
<div class="section" id="id36">
<h1>}<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h1>
<p>#### Parameters
- <cite>vcf_files</cite>: Path to a VCF file. Must contain the columns <cite>[#CHROM, POS, ID, REF, ALT]</cite>, in order. Column header does not need to be present. (All other columns in the file will be ignored.)
- <cite>save_data</cite>: A list of the data files to output. Must input 1 or more of the following options: <cite>[abs_diffs, diffs, logits, predictions]</cite>. (Note that the raw prediction values will not be outputted by default—you must specify <cite>predictions</cite> in the list if you want them.)
- <cite>output_dir</cite>: Output directory to write the model predictions. The resulting file will have the same filename prefix.
- <cite>output_format</cite>: Default is ‘tsv’. You may specify either ‘tsv’ or ‘hdf5’. ‘tsv’ is suitable if you do not have many variants (on the order of 10^4 or less) or your model does not predict very many classes (&lt;1000) and you want to be able to view the full set of predictions quickly and easily (via a text editor or Excel). ‘hdf5’ is suitable for downstream analysis. You can access the data in the HDF5 file using the Python package <cite>h5py</cite>. Once the file is loaded, the full matrix is accessible under the key/name <cite>“data”</cite>. Saving to TSV is much slower (more than 2x slower) than saving to HDF5. When the output is in HDF5 format, an additional .txt file of row labels (corresponding to the columns (chrom, pos, id, ref, alt)) will be output so that you can match up the data matrix rows with the particular variant. Columns of the matrix correspond to the classes the model predicts.
- <cite>strand_index</cite>: Default is None. If applicable, specify the column index (0-based) in the VCF file that contains strand information for each variant. Note that currently Selene assumes that, for multiple input VCF files, the strand column is the same for all the files. Importantly, the VCF file ref and alt alleles should still be specified for the forward strand–Selene will take the reverse complement for both if strand = ‘-‘.
- <cite>require_strand</cite>: Default is False. If <cite>strand_index</cite> is not None, <cite>require_strand = True</cite> means that Selene will skip all variants with strand specified as ‘.’ (that is, only keep variants with strand column value being ‘+’ or ‘-‘). If <cite>require_strand = False</cite>, variants with strand specified as ‘.’ will be treated as being on the ‘+’ strand.</p>
<p>#### Additional note
You may find that there are more output files than you expect in <cite>output_dir</cite> at the end of variant effect prediction. The following cases may occur:
- <strong>NAs:</strong> for some variants, Selene may not be able to construct a reference sequence centered at <cite>pos</cite> of the specified sequence length. This is likely because <cite>pos</cite> is near the end or the beginning of the chromosome and the sequence length the model accepts as input is large. You will find a list of NA variants in a file that ends with the extension <cite>.NA</cite>.
- <strong>Warnings:</strong> Selene may detect that the <cite>ref</cite> base(s) in a variant do not match with the bases specified in the reference sequence FASTA at the <cite>(chrom, pos)</cite>. In this case, Selene will use the <cite>ref</cite> base(s) specified in the VCF file in place of those in the reference genome and output predictions accordingly. These predictions will be distinguished by the row label column <cite>ref_match</cite> value <cite>False</cite>. You may review these variants and determine whether you still want to use those predictions/scores. If you find that most of the variants have <cite>ref_match = False</cite>, it may be that you have specified the wrong reference genome version—please check this before proceeding.</p>
<p>### _In <a href="#id111"><span class="problematic" id="id112">silico_</span></a> mutagenesis
An example configuration for _in <a href="#id113"><span class="problematic" id="id114">silico_</span></a> mutagenesis of the whole sequence (i.e. rather than a subsequence), when using a single sequence as input:
<a href="#id37"><span class="problematic" id="id38">``</span></a><a href="#id39"><span class="problematic" id="id40">`</span></a>YAML
in_silico_mutagenesis: {</p>
<blockquote>
<div><p>input_sequence: ATCGATAAAATTCTGGAG…,
save_data: [predictions, diffs],
output_path_prefix: /path/to/output/dir/filename_prefix,
mutate_n_bases: 1,
start_position: 0,
end_position: None</p>
</div></blockquote>
</div>
<div class="section" id="id41">
<h1>}<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h1>
<p>#### Parameters for a single sequence input
- <cite>sequence</cite>: A sequence you are interested in. If the sequence length is less than or greater than the expected model’s input sequence length, Selene truncates or pads (with unknown base, e.g. <cite>N</cite>) the sequence for you.
- <cite>save_data</cite>: A list of the data files to output. Must input 1 or more of the following options: <cite>[abs_diffs, diffs, logits, predictions]</cite>. (Note that the raw prediction values will not be outputted by default—you must specify <cite>predictions</cite> in the list if you want them.)
- <cite>output_path_prefix</cite>: Optional, default is “ism”. The path to which the data files are written. We have specified that it should be a filename _prefix_ because we will append additional information depending on what files you would like to output (e.g. <cite>fileprefix_logits.tsv</cite>) If directories in the path do not yet exist, they will automatically be created.
- <cite>mutate_n_bases</cite>: Optional, default is 1. The number of bases to mutate at any time. Standard _in <a href="#id115"><span class="problematic" id="id116">silico_</span></a> mutagenesis only mutates a single base at a time, so we encourage users to start by leaving this value at 1. Double/triple mutations will be more difficult to interpret and are something we may work on in the future.
- <cite>start_position</cite>: Optional, default is 0. The starting position of the subsequence that should be mutated. This value should be nonnegative, and less than <cite>end_position</cite>. Also, the value of <cite>end_position - start_position</cite> should be at least <cite>mutate_n_bases</cite>.
- <cite>end_position</cite>: Optional, default is <cite>None</cite>. If left as <cite>None</cite>, Selene will use the <cite>sequence_length</cite> parameter from <cite>analyze_sequences</cite>. This is the ending position of the subsequence that should be mutated. This value should be nonnegative, and greater than <cite>start_position</cite>. The value of <cite>end_position -  start_position</cite> should be at least <cite>mutate_n_bases</cite>.</p>
<p>An example configuration for _in <a href="#id117"><span class="problematic" id="id118">silico_</span></a> mutagenesis of the center 100 bases of a 1000 base sequence read from a FASTA file input:
<a href="#id42"><span class="problematic" id="id43">``</span></a><a href="#id44"><span class="problematic" id="id45">`</span></a>YAML
in_silico_mutagenesis: {</p>
<blockquote>
<div><p>input_path: /path/to/sequences1.fa,
save_data: [logits],
output_dir: /path/to/output/predictions/dir,
mutate_n_bases: 1,
use_sequence_name: True,
start_position: 450,
end_position: 550</p>
</div></blockquote>
</div>
<div class="section" id="id46">
<h1>}<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h1>
<p>#### Parameters for FASTA file input:
- <cite>input_path</cite>: Input path to the FASTA file. If you have multiple FASTA files, you can replace this key with <cite>fa_files</cite> and submit an input list, the same way it is done in variant effect prediction.
- <cite>save_data</cite>: A list of the data files to output. Must input 1 or more of the following options: <cite>[abs_diffs, diffs, logits, predictions]</cite>.
- <cite>output_dir</cite>: Output directory to write the model predictions.
- <cite>mutate_n_bases</cite>: Optional, default is 1. The number of bases to mutate at any time. Standard _in <a href="#id119"><span class="problematic" id="id120">silico_</span></a> mutagenesis only mutates a single base at a time, so we encourage users to start by leaving this value at 1.
- <cite>use_sequence_name</cite>: Optional, default is <cite>True</cite>.</p>
<blockquote>
<div><ul class="simple">
<li><p>If <cite>use_sequence_name</cite>, output files are prefixed by the sequence name/description corresponding to each sequence in the FASTA file. Spaces in the description are replaced with underscores ‘_’.</p></li>
<li><p>If not <cite>use_sequence_name</cite>, output files are prefixed with the index <cite>i</cite> corresponding to the <a href="#id47"><span class="problematic" id="id48">`</span></a>i`th sequence in the FASTA file.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><cite>start_position</cite>: Optional, default is 0. The starting position of the subsequence that should be mutated. This value should be nonnegative, and less than <cite>end_position</cite>. The value of <cite>end_position - start_position</cite> should be at least <cite>mutate_n_bases</cite>.</p></li>
<li><p><cite>end_position</cite>: Optional, default is <cite>None</cite>. If left as <cite>None</cite>, Selene will use the <cite>sequence_length</cite> parameter passed to <cite>analyze_sequences</cite>. This is the ending position of the subsequence that should be mutated. This value should be nonnegative, and greater than <cite>start_position</cite>. The value of <cite>end_position -  start_position</cite> should be at least <cite>mutate_n_bases</cite>.</p></li>
</ul>
<p>## Sampler configurations
Data sampling is used during model training and evaluation. You must specify the sampler in the configuration YAML file alongside the other operation-specific configurations (i.e. <cite>train_model</cite> or <cite>evaluate_model</cite>).</p>
<p>### Samplers used for training (and evaluation, optionally)
Training requires a sampler that specifies the data for training, validation, and (optionally) testing. While Selene can directly evaluate a trained model on a test dataset when training is finished, it is not a required step and so the test dataset specification is also optional. Here, we provide examples for the samplers we have implemented that can be used for training.</p>
<p>There are 2 kinds of samplers implemented in Selene right now: “online” samplers and file samplers. Online samplers generate data samples on-the-fly and require you to pass in a reference sequence FASTA file and a tabix-indexed BED file so that Selene can query for an input sequence and its associated biological classes using genomic coordinates. The file sampler we use supports loading different <cite>.mat</cite> or <cite>.bed</cite> files (can support more formats upon request) for the training, validation, and test sets.</p>
<p>For increased efficiency during the training of large models, we would recommend using the online sampler to create datasets (.bed or .mat) and then loading the generated data with a file sampler. We are actively working to incorporate PyTorch dataloaders and other improvements to data sampling into Selene to reduce the time and memory requirements of training. Feel free to contact us through our [Github issues](<a class="reference external" href="https://github.com/FunctionLab/selene/issues">https://github.com/FunctionLab/selene/issues</a>) if you have comments or want to contribute to this effort!</p>
<p>#### Random positions sampler
The random positions sampler will construct data samples by randomly selecting a position in the genome and then using the sequence and classes centered at that position as the input and targets for the model to predict.</p>
<p>An example configuration for the random positions sampler:
<a href="#id49"><span class="problematic" id="id50">``</span></a><a href="#id51"><span class="problematic" id="id52">`</span></a>YAML
sampler: !obj:selene_sdk.samplers.RandomPositionsSampler {</p>
<blockquote>
<div><dl class="simple">
<dt>reference_sequence: !obj:selene_sdk.sequences.Genome {</dt><dd><p>input_path: /path/to/reference_sequence.fa,
blacklist_regions: hg19</p>
</dd>
</dl>
<p>},
features: !obj:selene_sdk.utils.load_features_list {</p>
<blockquote>
<div><p>input_path: /path/to/features_list.txt</p>
</div></blockquote>
<p>},
target_path: /path/to/targets_bed.gz,
seed: 123,
validation_holdout: [chr6, chr7],
test_holdout: [chr8, chr9],
sequence_length: 1000,
center_bin_to_predict: 200,
feature_thresholds: 0.5,
mode: train,
save_datasets: [train, validate, test]</p>
</div></blockquote>
</div>
<div class="section" id="id53">
<h1>}<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h1>
<p>##### Required parameters
- <cite>reference_sequence</cite>: Path to a reference sequence FASTA file we can query to create our data samples.</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>blacklist_regions</cite> is an optional argument for <cite>selene_sdk.sequences.Genome</cite> that allows you to specify the blacklist regions for the hg19 or hg38 reference sequence. The lists of blacklisted intervals are provided by [Anshul Kundaje for ENCODE](<a class="reference external" href="https://sites.google.com/site/anshulkundaje/projects/blacklists">https://sites.google.com/site/anshulkundaje/projects/blacklists</a>) and support for more organisms can be included upon request.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><cite>target_path</cite>: Path to a tabix-indexed, compressed BED file (<cite>.bed.gz</cite>) of genomic coordinates corresponding to the measurements for genomic features/classes the model should predict.</p></li>
<li><p><cite>features</cite>: The list of distinct features the model predicts. (<cite>input_path</cite> to the function-type value that loads the file of features as a list.)</p></li>
</ul>
<p>##### Optional parameters
- <cite>seed</cite>: Default is 436.
- <cite>validation_holdout</cite>: Default is <cite>[chr6, chr7]</cite>. Holdout can be regional (i.e. chromosomal) or proportional.</p>
<blockquote>
<div><ul class="simple">
<li><p>If regional, expects a list where the regions must match those specified in the first column of the tabix-indexed BED file <cite>target_path</cite> (which must also match the FASTA descriptions for every record in <cite>reference_sequence</cite>).</p></li>
<li><p>If proportional, specify a percentage between (0.0, 1.0). Typically 0.10 or 0.20.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><cite>test_holdout</cite>: Default is <cite>[chr8, chr9]</cite>. Holdout can be regional (i.e. chromosomal) or proportional. See description of <cite>validation_holdout</cite>.</p></li>
<li><p><cite>sequence_length</cite>: Default is 1000. Model is trained on sequences of <cite>sequence_length</cite>.</p></li>
<li><p><cite>center_bin_to_predict</cite>: Default is 200. Query the tabix-indexed file for a region of length <cite>center_bin_to_predict</cite>, centered in the input sequence of <cite>sequence_length</cite>.</p></li>
<li><dl class="simple">
<dt><cite>feature_thresholds</cite>: Default is 0.5. The threshold to pass to the <cite>selene_sdk.targets.Targets</cite> object. Because we have only implemented support for genomic features right now, we reproduce the threshold inputs for that here:</dt><dd><ul>
<li><dl class="simple">
<dt>A genomic region is determined to be a positive sample if at least one genomic feature interval takes up some proportion of the region greater than or equal to the corresponding threshold.</dt><dd><ul>
<li><p><cite>float</cite>: A single threshold applied to all the features in your dataset.</p></li>
<li><p><cite>dict</cite>: A dictionary mapping feature names (<cite>str</cite>) to thresholds (<cite>float</cite>). This is used if you want to assign different thresholds for different features. If a feature’s threshold is not specified in the dictionary, you must have the key <cite>default</cite> with a default threshold value we can use for that feature.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p><cite>mode</cite>: Default is ‘train’. Must be one of <cite>{train, validate, test}</cite>. The starting mode in which to run this sampler.</p></li>
<li><p><cite>save_datasets</cite>: Default is <cite>[test]</cite>. The list of modes for which we should save the sampled data to file. Should be one or more of <cite>{train, validate, test}</cite>.</p></li>
</ul>
<p>#### Intervals sampler
The intervals sampler will construct data samples by randomly selecting positions only in the regions specified by an intervals <cite>.bed</cite> file and then using the sequence and classes centered at that position as the input and targets for the model to predict.</p>
<p>An example configuration for the intervals sampler:
<a href="#id54"><span class="problematic" id="id55">``</span></a><a href="#id56"><span class="problematic" id="id57">`</span></a>YAML
sampler: !obj:selene_sdk.samplers.IntervalsSampler {</p>
<blockquote>
<div><dl class="simple">
<dt>reference_sequence: !obj:selene_sdk.sequences.Genome {</dt><dd><p>input_path: /path/to/reference_sequence.fa,
blacklist_regions: hg38</p>
</dd>
</dl>
<p>},
target_path: /path/to/targets.bed.gz,
features: !obj:selene_sdk.utils.load_features_list {</p>
<blockquote>
<div><p>input_path: /path/to/features_list.txt</p>
</div></blockquote>
<p>},
intervals_path: /path/to/intervals.bed,
sample_negative: False,
seed: 436,
validation_holdout: 0.10,
test_holdout: 0.10,
sequence_length: 1000,
center_bin_to_predict: 100,
feature_thresholds: {“feature1”: 0.5, “default”: 0.1},
mode: test,
save_datasets: [test]</p>
</div></blockquote>
<p><a href="#id58"><span class="problematic" id="id59">``</span></a>`
##### Parameters
With the exception of <cite>intervals_path</cite> and <cite>sample_negative</cite>, all other parameters match those for the random positions sampler. Please see the previous section for more details on the other parameters.
- <cite>intervals_path</cite>: The path to the intervals file. Must have the columns <cite>[chr, start, end]</cite>, where values in <cite>chr</cite> should match the descriptions in the FASTA file. We constrain the regions from which we sample to the regions in this file instead of the using the whole genome.
- <cite>sample_negative</cite>: Optional, default is False. Specify whether negative examples (i.e. samples with no positive labels) should be drawn. When False, the sampler will check if the <cite>center_bin_to_predict</cite> in the input sequence contains at least 1 of the features/classes the model wants to predict. When True, no such check is made.</p>
<p>#### Multiple-file sampler</p>
<p>The multi-file sampler loads in the training, validation, and optionally, the testing dataset.  The configuration for this therefore asks that you fill in some keys with the function-type constructors of type <cite>selene_sdk.samplers.file_samplers.FileSampler</cite>. Please consult the following sections for information about these file samplers.</p>
<p>An example configuration for the multiple-file sampler:
<a href="#id60"><span class="problematic" id="id61">``</span></a><a href="#id62"><span class="problematic" id="id63">`</span></a>YAML
sampler: !obj:selene_sdk.samplers.MultiFileSampler {</p>
<blockquote>
<div><dl class="simple">
<dt>train_sampler: !obj:selene_sdk.samplers.file_samplers.MatFileSampler {</dt><dd><p>…</p>
</dd>
</dl>
<p>},
validate_sampler: !obj:selene_sdk.samplers.file_samplers.MatFileSampler {</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>},
features: !obj:selene_sdk.utils.load_features_list {</p>
<blockquote>
<div><p>input_path: /path/to/features_list.txt</p>
</div></blockquote>
<p>},
test_sampler: !obj:selene_sdk.samplers.file_samplers.BedFileSampler {</p>
<blockquote>
<div><p>…</p>
</div></blockquote>
<p>},
mode: train</p>
</div></blockquote>
</div>
<div class="section" id="id64">
<h1>}<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h1>
<p>##### Parameters
- <cite>train_sampler</cite>: Load your training data from either a <cite>.bed</cite> file (<cite>selene_sdk.samplers.file_sampler.BedFileSampler</cite>) or <cite>.mat</cite> file (<cite>selene_sdk.samplers.file_sampler.MatFileSampler</cite>).
- <cite>validate_sampler</cite>: Sample as <cite>train_sampler</cite>.
- <cite>test_sampler</cite>: Optional, default is <cite>None</cite>. Same as <cite>train_sampler</cite>.
- <cite>features</cite>: The list of distinct features the model predicts. (<cite>input_path</cite> to the function-type value that loads the file of features as a list.)
- <cite>mode</cite>: Default is ‘train’. Must be one of <cite>{train, validate, test}</cite>. The starting mode in which to run this sampler.</p>
<p>### Important note
If you use any of these samplers (that is, samplers with multiple data partitions) with the [<cite>evaluate_model</cite> configuration](#evaluate), please make sure that your <cite>mode</cite> is set to <cite>test</cite>.</p>
<p>### Samplers used for evaluation
You can use all the samplers specified for training for evaluation as well (see note above). Additionally, you can use single-file samplers, which we describe below.</p>
<p>#### BED file sampler
The BED file sampler loads a dataset from a <cite>.bed</cite> file. This can be generated by one of the online samplers in Selene with the <cite>save_dataset</cite> parameter.</p>
<p>An example configuration for a BED file sampler:
<a href="#id65"><span class="problematic" id="id66">``</span></a><a href="#id67"><span class="problematic" id="id68">`</span></a>YAML
sampler: !obj:selene_sdk.samplers.file_samplers.BedFileSampler {</p>
<blockquote>
<div><p>filepath: /path/to/data.bed,
reference_sequence: !obj:selene_sdk.sequences.Genome {</p>
<blockquote>
<div><p>input_path: /path/to/reference_sequence.fa</p>
</div></blockquote>
<p>},
n_samples: 640000,
sequence_length: 1000,
targets_avail: True,
n_features: 919,</p>
</div></blockquote>
</div>
<div class="section" id="id69">
<h1>}<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h1>
<p>##### Parameters
- <cite>filepath</cite>: Path to the BED file.
- <cite>reference_sequence</cite>: Path to a reference sequence FASTA file we can query to create our data samples.
- <cite>n_samples</cite>: Number of lines in the file. (<cite>wc -l &lt;filepath&gt;</cite>)
- <cite>sequence_length</cite>: Optional, default is None. If the coordinates of each sample in the BED file, already account for the full sequence (that is, the columns <cite>end - start = sequence_length</cite>, there is no need to specify this parameter. If <cite>sequence_length</cite> is not None, the length of each sample will be checked to determine whether the sample coordinates need to be adjusted to match the sequence length expected by the model architecture.
- <cite>targets_avail</cite>: Optional, default is False. If <cite>targets_avail</cite>, assumes that it is the last column of the <cite>.bed</cite> file. The last column should contain the indices, separated by semicolons, of features (classes) found within a given sample’s coordinates (e.g. 0;1;45;60). This format assumes that we are only looking for the absence/presence of each feature within the interval.
- <cite>n_features</cite>: Optional, default is None. If <cite>targets_avail</cite> is True, must specify <cite>n_features</cite>, the total number of features (classes).</p>
<p>#### Matrix file sampler
The matrix file sampler loads a dataset from a matrix file.</p>
<p>An example configuration for a matrix file sampler:
<a href="#id70"><span class="problematic" id="id71">``</span></a><a href="#id72"><span class="problematic" id="id73">`</span></a>YAML
sampler: !obj:selene_sdk.samplers.file_samplers.MatFileSampler {</p>
<blockquote>
<div><p>filepath: /path/to/data.mat,
sequence_key: sequences,
targets_key: targets,
random_seed: 123,
shuffle: True,
sequence_batch_axis: 0,
sequence_alphabet_axis: 1,
targets_batch_axis: 0</p>
</div></blockquote>
</div>
<div class="section" id="id74">
<h1>}<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h1>
<p>##### Parameters
- <cite>filepath</cite>: The path to the file from which to load the data.
- <cite>sequence_key</cite>: The key for the sequences data matrix.
- <cite>targets_key</cite>: Optional, default is <cite>None</cite>. The key to the targets data matrix.
- <cite>random_seed</cite>: Optional, default is 436. Sets the random seed for sampling.
- <cite>shuffle</cite>: Optional, default is <cite>True</cite>. Shuffle the order of the samples in the matrix before sampling from it.
- <cite>sequence_batch_axis</cite>: Optional, default is 0. Specify the batch axis for the sequences matrix.
- <cite>sequence_alphabet_axis</cite>: Optional, default is 1. Specify the alphabet axis.
- <cite>targets_batch_axis</cite>: Optional, default is 0. Specify the batch axis for the targets matrix.</p>
<p>## Examples of full configuration files
We do have a more comprehensive set of [examples on our Github](<a class="reference external" href="https://github.com/FunctionLab/selene/blob/master/config_examples">https://github.com/FunctionLab/selene/blob/master/config_examples</a>) that you can review. We reproduce a few of these in this document to show how you can put all of the different configuration components together to create a YAML file that can be run by Selene’s CLI:</p>
<p>### Training (using intervals sampler)
<a href="#id75"><span class="problematic" id="id76">``</span></a><a href="#id77"><span class="problematic" id="id78">`</span></a>YAML
—
ops: [train, evaluate]
model: {</p>
<blockquote>
<div><p>path: /absolute/path/to/model/architecture.py,
class: ModelArchitectureClassName,
class_args: {</p>
<blockquote>
<div><p>arg1: val1,
arg2: val2</p>
</div></blockquote>
<p>},
non_strand_specific: mean</p>
</div></blockquote>
<p>}
sampler: !obj:selene_sdk.samplers.IntervalsSampler {</p>
<blockquote>
<div><dl class="simple">
<dt>reference_sequence: !obj:selene_sdk.sequences.Genome {</dt><dd><p>input_path: /path/to/reference_sequence.fa,
blacklist_regions: hg19</p>
</dd>
</dl>
<p>},
target_path: /path/to/tabix/indexed/targets.bed.gz,
features: !obj:selene_sdk.utils.load_features_list {</p>
<blockquote>
<div><p>input_path: /path/to/distinct_features.txt</p>
</div></blockquote>
<p>},
intervals_path: /path/to/intervals.bed,
sample_negative: True,
seed: 127,
validation_holdout: [chr6, chr7],
test_holdout: [chr8, chr9],  # specifying a test partition
sequence_length: 1000,
center_bin_to_predict: 200,
feature_thresholds: 0.5,
mode: train,  # starting mode for sampler
save_datasets: [test]</p>
</div></blockquote>
<p>}
train_model: !obj:selene_sdk.TrainModel {</p>
<blockquote>
<div><p>batch_size: 64,
max_steps: 80000,
report_stats_every_n_steps: 16000,
n_validation_samples: 32000,
n_test_samples: 640000,
cpu_n_threads: 32,
use_cuda: True,
data_parallel: True,
logging_verbosity: 2,
checkpoint_resume: False</p>
</div></blockquote>
<p>}
random_seed: 133
output_dir: /path/to/output_dir
…
<a href="#id79"><span class="problematic" id="id80">``</span></a><a href="#id81"><span class="problematic" id="id82">`</span></a></p>
<p>#### Some notes
- Ordering of the keys does not matter.
- We included many of the optional keys in this configuration. You do not need to specify these if you want to use their default values.
- In this example, we specified a test partition in our intervals sampler by assigning a list of chromosomes to <cite>test_holdout</cite>. If no such holdout was specified (e.g. None or empty list), you would not be able to specify <cite>n_test_samples</cite> in <cite>TrainModel</cite> and would need to omit <cite>evaluate</cite> from the <cite>ops</cite> list.
- <cite>output_dir</cite> is specified at the top-level and used by both the sampler and the <cite>TrainModel</cite> class.</p>
<p>### Evaluate (using matrix file sampler)
<a href="#id83"><span class="problematic" id="id84">``</span></a><a href="#id85"><span class="problematic" id="id86">`</span></a>YAML
—
ops: [evaluate]
model: {</p>
<blockquote>
<div><p>path: /absolute/path/to/model/architecture.py,
class: ModelArchitectureClassName,
class_args: {</p>
<blockquote>
<div><p>arg1: val1,
arg2: val2</p>
</div></blockquote>
<p>},
non_strand_specific: mean</p>
</div></blockquote>
<p>}
sampler: !obj:selene_sdk.samplers.file_samplers.MatFileSampler {</p>
<blockquote>
<div><p>filepath: /path/to/test.mat,
sequence_key: testxdata,
targets_key: testdata,
random_seed: 456,
shufle: False,
sequence_batch_axis: 0,
sequence_alphabet_axis: 1,
targets_batch_axis: 0</p>
</div></blockquote>
<p>}
evaluate_model: !obj:selene_sdk.EvaluateModel {</p>
<blockquote>
<div><dl class="simple">
<dt>features: !obj:selene_sdk.utils.load_features_list {</dt><dd><p>input_path: /path/to/features_list.txt</p>
</dd>
</dl>
<p>},
trained_model_path: /path/to/trained/model.pth.tar,
batch_size: 64,
report_gt_feature_n_positives: 50,
use_cuda: True,
data_parallel: False</p>
</div></blockquote>
<p>}
random_seed: 123
output_dir: /path/to/output_dir
create_subdirectory: False
…
<a href="#id87"><span class="problematic" id="id88">``</span></a><a href="#id89"><span class="problematic" id="id90">`</span></a></p>
<p>### Some notes
- For the matrix file sampler, we assume that you know ahead of time the shape of the data matrix. That is, which dimension is the batch dimension? Sequence? Alphabet (should be size 4 for DNA/RNA)? You must specify the keys that end in <cite>axis</cite> unless the shape of the sequences matrix is <cite>(n_samples, n_alphabet, n_sequence_length)</cite> and the shape of the targets matrix is <cite>(n_samples, n_targets)</cite>.
- In this case, since <cite>create_subdirectory</cite> is False, all outputs from evaluate are written to <cite>output_dir</cite> directly (as opposed to being written in a timestamped subdirectory). Be careful of overwriting files.</p>
<p>### Analyze sequences (variant effect prediction)
<a href="#id91"><span class="problematic" id="id92">``</span></a><a href="#id93"><span class="problematic" id="id94">`</span></a>YAML
ops: [analyze]
model: {</p>
<blockquote>
<div><p>path: /absolute/path/to/model/architecture.py,
class: ModelArchitectureClassName,
class_args: {</p>
<blockquote>
<div><p>arg1: val1,
arg2: val2</p>
</div></blockquote>
<p>},
non_strand_specific: mean</p>
</div></blockquote>
<p>}
analyze_sequences: !obj:selene_sdk.predict.AnalyzeSequences {</p>
<blockquote>
<div><p>trained_model_path: /path/to/trained/model.pth.tar,
sequence_length: 1000,
features: !obj:selene_sdk.utils.load_features_list {</p>
<blockquote>
<div><p>input_path: /path/to/distinct_features.txt</p>
</div></blockquote>
<p>},
batch_size: 64,
use_cuda: True,
reference_sequence: !obj:selene_sdk.sequences.Genome {</p>
<blockquote>
<div><p>input_path: /path/to/reference_sequence.fa</p>
</div></blockquote>
<p>},
write_mem_limit: 75000</p>
</div></blockquote>
<p>}
variant_effect_prediction: {</p>
<blockquote>
<div><dl class="simple">
<dt>vcf_files: [</dt><dd><p>/path/to/file1.vcf,
/path/to/file2.vcf</p>
</dd>
</dl>
<p>],
save_data: [predictions, abs_diffs],
output_dir: /path/to/output/predicts/dir,
output_format: tsv,
strand_index: 9</p>
</div></blockquote>
<p>}
random_seed: 123
<a href="#id95"><span class="problematic" id="id96">``</span></a><a href="#id97"><span class="problematic" id="id98">`</span></a></p>
<p>#### Some notes
- We ask that in all <cite>analyze</cite> cases, you specify the <cite>output_dir</cite> (when applicable) within the sub-operation dictionary. This is because only the sub-operation generates output, so there is no need to share this parameter across multiple configurations.
- In this variant effect prediction example, Selene will go through each VCF file and get the model predictions for each variant (ref and alt). <cite>analyze_sequences</cite> must have the parameter <cite>reference_sequence</cite> so that Selene can create sequences centered at each variant position by querying the reference sequence file.
- The output from this operation will be 6 files: 3 for each input VCF file. This is because of what is specified in <cite>save_data</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>predictions</cite> will output 2 files per input VCF: the model predictions for all <cite>ref`s and the model predictions for all `alts</cite>.</p></li>
<li><p><cite>abs_diffs</cite> will output 1 file per input VCF: the absolute difference between the <cite>ref</cite> and <cite>alt</cite> model predictions. (Certainly, outputting the files from <cite>predictions</cite> is sufficient to compute <cite>abs_diffs</cite> yourself.)</p></li>
</ul>
</div></blockquote>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="faq.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorials.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Selene Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>